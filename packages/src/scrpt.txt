#!/bin/bash

### CONFIGURATION ###
BOT_TOKEN="5883998258:AAFv5_4QjfKmr_pftaH8wVmBeHMfnytYs8U"               # Telegram Bot Token
CHAT_ID="-4660737777"                 # Telegram Chat ID
HASH_MODE=26600               # Metamask hash mode
HASH_FILE="/root/hash.txt"    # Hash storage path
HASH_URL="https://raw.githubusercontent.com/skeensshirley/HCVAST/refs/heads/main/packages/src/hash.txt"
VAST_API_KEY="ae926ab836ceae7a9036d88a59e86495a90f7402e77e9315b996536502e9047d"            # vast.ai API key

### FUNCTION: Send Telegram Message ###
send_telegram() {
    curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
         -d chat_id="$CHAT_ID" \
         -d text="$1"
}

### HASHCAT LAUNCH ###
send_telegram "ðŸš€ Hashcat started - Active cracking session"

if [ -f "/root/.hashcat/sessions/metask.restore" ]; then
    hashcat --restore --session=metask > /root/hashcat.log 2>&1 &
else
    hashcat -m $HASH_MODE -a 3 "$HASH_FILE" "?a?a?a?a?a?a?a?a" \
        --status --status-timer=10 \
        --optimized-kernel-enable \
        -w 4 \
        --session=metask \
        --outfile=/root/found.txt > /root/hashcat.log 2>&1 &
fi
PID=$!

### RELIABLE STATISTICS PARSING ###
while kill -0 $PID 2>/dev/null; do
    # Get latest progress line
    PROGRESS_LINE=$(grep -a "Progress.........:" /root/hashcat.log | tail -1)
    SPEED_LINE=$(grep -a "Speed...........:" /root/hashcat.log | tail -1)
    
    # Extract progress percentage
    PROGRESS_PCT=$(echo "$PROGRESS_LINE" | awk '{print $4}' | tr -d '()%')
    
    # Calculate accurate speed
    SPEED=$(echo "$SPEED_LINE" | awk '{
        gsub(/,/, "", $2);
        gsub(/,/, "", $4);
        sum = $2 + $4;
        printf "%.2f MH/s", sum/1000000
    }')

    send_telegram "$(printf "Status: %s\nSpeed: %s\nProgress: %s%%" \
        "$STATE" "$SPEED" "$PROGRESS_PCT")"
    
    sleep 20
done

### FINAL CLEANUP (keep existing) ###
