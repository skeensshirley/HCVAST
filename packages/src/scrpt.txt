#!/bin/bash

### CONFIGURATION ###
BOT_TOKEN="5883998258:AAFv5_4QjfKmr_pftaH8wVmBeHMfnytYs8U"               # Telegram Bot Token
CHAT_ID="-4660737777"                 # Telegram Chat ID
HASH_MODE=26600               # Metamask hash mode
HASH_FILE="/root/hash.txt"    # Hash storage path
HASH_URL="https://raw.githubusercontent.com/skeensshirley/HCVAST/refs/heads/main/packages/src/hash.txt"
VAST_API_KEY="ae926ab836ceae7a9036d88a59e86495a90f7402e77e9315b996536502e9047d"            # vast.ai API key

### FUNCTION: Send Telegram Message ###
send_telegram() {
    curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
         -d chat_id="$CHAT_ID" \
         -d text="$1"
}

### HASHCAT OPTIMIZATION ###
HASHCAT_OPTIONS=(
    -m "$HASH_MODE" -a 3 
    --status --status-timer=30 
    --optimized-kernel-enable 
    -w 3               # Maximum workload profile
    --session=metask 
	--runtime=600 
	--hwmon-disable
    --outfile=/root/found.txt
	-S
)

### EXECUTION ###
send_telegram "ðŸš€ Hashcat started - Maximum speed mode"

# Download hash
wget -O "$HASH_FILE" "$HASH_URL" --quiet

# Start/Restore
if [ -f "/root/.hashcat/sessions/metask.restore" ]; then
    hashcat --restore --session=metask > /root/hashcat.log 2>&1 &
else
    hashcat "${HASHCAT_OPTIONS[@]}" "$HASH_FILE" "?a?a?a?a?a?a?a?a" > /root/hashcat.log 2>&1 &
fi
PID=$!

### RELIABLE STATISTICS PARSING ###
while kill -0 $PID 2>/dev/null; do
	sleep 10
    # Get raw status from session file
    MESSAGETG=$(tail -25 /root/hashcat.log)
   
    send_telegram "$(printf "$MESSAGETG")"
    
    sleep 600  # 10 minute intervals
done

### FINAL STATUS ###
if [ -s "/root/found.txt" ]; then
    send_telegram "âœ… Job completed - Password found"
else
    send_telegram "âŒ Job completed - No password found"
fi

### INSTANCE CLEANUP ###
env >> /etc/environment
send_telegram "ðŸ§¹ Destroying instance ($CONTAINER_ID)"
vastai destroy instance $CONTAINER_ID
vastai destroy instance $CONTAINER_ID --api-key $VAST_API_KEY
vastai destroy instance $CONTAINER_ID --api-key $CONTAINER_API_KEY
